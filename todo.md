1. Simplify the code
1.1 Extract the media pipe initialization to a separate hook
1.2 Try to make the code in a more reactive and functional way (pure functions) rather than sharing references everywhere